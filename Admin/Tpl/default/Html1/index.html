<include file="Public:header" />
<style>
div.lanmu { margin-top:20px;}
.kuai h3{ padding-left:10px; height:30px; line-height:30px; border-bottom:1px solid #ddd; background: -webkit-gradient(linear, 0 0, 0 100%, from(#FFFFFF), to(#F5F5F5));
background: -moz-linear-gradient(top, #FFFFFF, #F5F5F5); color:#666;}

.kuai{ float:left; width:230px; border:1px solid #ddd; margin-right:10px; padding-bottom:10px;}
.kuai table{ margin:6px;}
.cl{ clear:both;}
.bb{ line-height:24px; height:25px; border-radius:1px; width:80px; color:#666; font-size:12px; text-align:center; _background:#f7f7f7; border:1px solid #ccc;
background: -webkit-gradient(linear, 0 0, 0 100%, from(#FFFFFF), to(#F2F2F2));
background: -moz-linear-gradient(top, #FFFFFF, #F2F2F2);

}

.bb:hover{ border:1px dashed #666;}
</style>
<script type="text/javascript">

 function getItem() {
        var selectRow = Array();
        var obj = document.getElementsByName('module');
        var result = '';
        var j = 0;
        for (var i = 0; i < obj.length; i++) {
            if (obj[i].checked == true) {
                selectRow[j] = i + 1;
                result += obj[i].value + ",";
                j++;
            }
        }
        return result.substring(0, result.length - 1);
    }



 function getItem1() {
        var selectRow = Array();
        var obj = document.getElementsByName('cat');
        var result = '';
        var j = 0;
        for (var i = 0; i < obj.length; i++) {
            if (obj[i].checked == true) {
                selectRow[j] = i + 1;
                result += obj[i].value;
                j++;
            }
        }
        return result.substring(0, result.length - 1);
    }










function shengcheng(p,mod){
	
$('#mbox').show(0);
if(p==""){p=1;}

else(p=p);

    // alert(mod);               

  $.ajax({   

     type:"GET",   

 url:"{:U('Html/dohtml')}",

 data:{page:p,mod:mod},   

 beforeSend:function(){

 $("#msg").html("正在生成"); 

 },                

 success:function(data){

$("#msg1").html(data);//调试信息
//return false;
 back_arr=eval("("+data+")");

 



 //返回json数据

//赋值给提示元素
                    $("#msg").before("正在生成"+back_arr.content+"<br/>"); 
                    $("#msg").before("正在生成第"+back_arr.ppage+"页<br/>"); 
                    $("#mbox").scrollTop(9999);
					
					
if(parseInt(back_arr.ppage)==parseInt(back_arr.Page_cont)  || back_arr.Page_cont == 0 )

{

$("#bb").attr("value",back_arr.module+"生成完毕");
//$('#mbox').hide(0);

$("#bb").attr("disabled","");//执行中放置点击按钮
return false;
}

else

{

$("#bb").attr("disabled","disabled");//执行中防止点击按钮 

setTimeout(function(){
	
	shengcheng(parseInt(back_arr.ppage)+1,mod);
	
	},100);

}

      }

 

      });


 //document.write("执行了");

};








function shenglanmu(p,mod){
	
$('#mbox1').show(0);
if(p==""){p=1;}

else(p=p);

                   

  $.ajax({   

     type:"GET",   

 url:"{:U('Html/docat')}",

 data:{page:p,mod:getItem1()},   

 beforeSend:function(){

 $("#msg1").html("正在生成"); 

 },                

 success:function(data){

$("#msg1").html(data);//调试信息

 }
 

      });


 //document.write("执行了");

};










$(document).ready(function(){


$("#bb").click(function(){



 var selectRow = Array();
        var obj = document.getElementsByName('module');
        var result = '';
		
		for(var i=0;i<obj.length;i++){
			
			if (obj[i].checked == true) {
                
          //  alert(obj[i].value);
			
			shengcheng(1,obj[i].value);
			}
			
			
			
			}


});

$("#bb1").click(function(){

shenglanmu(1);


});

$('#quan').click(function(e) {
    if($('.lanmu input:checkbox').attr('checked') != true){
	$('.lanmu input:checkbox').attr('checked','checked');
	
	//alert(getItem1());
	}
	else
	{
	$('.lanmu input:checkbox').attr('checked',false);	
	}
	
});



$('#quan2').click(function(e) {
    if($('.jingtai input:checkbox').attr('checked') != true){
	$('.jingtai input:checkbox').attr('checked','checked');
	
	
	}
	else
	{
	$('.jingtai input:checkbox').attr('checked',false);	
	}
	
});



});

</script>
<tagLib name="html,cx" />
<style>
.maininner{}.bb1 {line-height:24px; height:25px; border-radius:1px; width:80px; color:#666; font-size:12px; text-align:center; _background:#f7f7f7; border:1px solid #ccc;
background: -webkit-gradient(linear, 0 0, 0 100%, from(#FFFFFF), to(#F2F2F2));
background: -moz-linear-gradient(top, #FFFFFF, #F2F2F2);
}
</style>
<div class="mainarea">
	<div class="maininner">
	  <div class="body_content" style="padding:15px; padding-top:0px">
			<div class="title">
			  <h3>静态页面生成</h3></div>
			
<div class="jingtai">
<div class="kuai">
<h3>生产模块文章</h3>
<table id="mokuai">

<volist name="mod_array" id="vo"><tr>
<td width="38" height="32" align="center"><input type="checkbox" name="module" id="module[]"  value="{$vo['name']}"/></td><td width="149"><label>{$vo['title']}</label></td></tr>
</volist>


</table>
</div>
<div class="cl"></div>
<div id='mbox' style="height:300px; overflow:auto; border:1px solid #CCC; display:none">
  <div id="msg"></div>
</div><div style="height:20px; clear:both;"></div> 
<table width="156">
  <tr>
    <td width="22" align="center" valign="middle"><input type="checkbox" id="quan2" /></td>
    <td width="35">全选</td>
    <td width="83"><input class="bb1" type="button" id="bb" value="生成详细"/></td>
  </tr>
</table>
<div id="msg1"></div>
</div>

<div class="lanmu">






<volist name="mod_array" id="vo"></volist>
<div class="cl"></div>

<div class="mbox1">
<span id="msg1"></span>
</div>

<table cellspacing="0" cellpadding="0" id="maintable" class="formtable" style="border:1px solid #ddd; margin:0px;">
            <tr>
              <th width="30" style="width:30px">&nbsp;</th>
              <th width="336">名称</th>
             
              <th width="164" style="width:15%">录入时间</th>
              
            </tr>
            <present name="dataList">
            <volist name="dataList" id="vo">
              <tr style="{$vo.parent_id|bgStyle=0,'background:#F7F7F7; margin-left:-30px; font-weight:bold;vertical-align:middle'}">
                <td align="center"><if condition="$vo['parent_id'] neq 0"><input type="checkbox" name="cat" id="cat[]"  value="{$vo.title},{$vo.md},{$vo.biaozhi},{$vo.id}|"/></if></td>
                <td align="left">{$vo.str_repeat}{$vo.title} {$vo.status|statusIcon=1,$frontUrl,'hidden.gif','隐藏'} {$vo.protected|statusIcon=1,$frontUrl,'lock.gif','保护中'}</td>
              
                <td>{$vo.create_time|date="Y-m-d",###}</td>
               
              </tr>
            </volist> 
            <else />
            <td colspan="5" style="color:#F00; font-weight:bold">暂无数据</td>
            </present>
          </table>
</div>
<div style="height:20px; clear:both;"></div> 
<table width="156">
<tr>
<td width="22" align="center" valign="middle">
<input type="checkbox" id="quan" /></td><td width="35">全选</td>
<td width="83"><input class="bb" type="button" id="bb1" value="生成栏目"/></td>
</tr>
</table>
</div>
		</div>
           
        	
  </div>

<div class="side">
  <include file="Public:sider" />
</div>
<include file="Public:footer" />
<div id="haha"></div>
